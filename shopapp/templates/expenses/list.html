{% extends 'layout.html' %}
{% block content %}
<div class="bo-card mb-4">
  <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h4 mb-1">Record expense</h1>
      <p class="bo-soft mb-0">Tag spend against categories. Keywords auto-suggest based on rules.</p>
    </div>
    <a class="btn btn-sm bo-btn-outline" href="{{ url_for('expenses.categories') }}">Manage categories</a>
  </div>
  <form class="row g-3" method="POST">
    <div class="col-md-2">
      <label class="form-label">Date</label>
      <input class="form-control bo-input" type="date" name="date" value="{{ request.form.get('date', '') }}">
    </div>
    <div class="col-md-4">
      <label class="form-label">Category</label>
      <select class="form-select bo-input" name="category_id">
        <option value="">Auto / choose…</option>
        {% for cat in categories %}
        <option value="{{ cat.id }}">{{ cat.name }}</option>
        {% endfor %}
      </select>
      <small class="bo-soft">Need a one-off label? Type it below.</small>
      <input class="form-control bo-input mt-2" type="text" name="category" placeholder="Optional custom category">
    </div>
    <div class="col-md-3">
      <label class="form-label">Amount</label>
      <input class="form-control bo-input" type="number" step="0.01" name="amount" required>
    </div>
    <div class="col-md-3">
      <label class="form-label">Notes</label>
      <textarea class="form-control bo-input" name="notes" rows="1" placeholder="Supplier, reference, etc."></textarea>
    </div>
    <div class="col-12 text-end">
      <button class="btn bo-btn" type="submit">Save expense</button>
    </div>
  </form>
</div>

<div class="bo-card">
  <h2 class="h5 mb-3">Recent expenses</h2>
  <div class="table-responsive">
    <table class="table table-dark table-hover align-middle mb-0 bo-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Category</th>
          <th>Amount</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody>
        {% for e in expenses %}
        {% set badge_color = e.category_rel.color if e.category_rel else '#62b5ff' %}
        <tr>
          <td>{{ e.date }}</td>
          <td>
            <span class="badge" style="background-color: {{ badge_color }}; color: #0e1629;">
              {{ e.category or 'Uncategorised' }}
            </span>
          </td>
          <td>Rs {{ '%.2f'|format(e.amount) }}</td>
          <td>{{ e.notes or '—' }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="4" class="bo-soft">No expenses recorded yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
