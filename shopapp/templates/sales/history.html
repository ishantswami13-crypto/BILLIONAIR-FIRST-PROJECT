{% extends "layout.html" %}
{% block title %}Sales · ShopApp{% endblock %}

{% block content %}
<section class="hero fade-in" style="padding:70px 10% 30px">
  <h1>Sales</h1>
  <p>Filter by date or customer, export when needed.</p>
</section>

<div class="grid">
  <div class="card fade-in">
    <h2>Filters</h2>
    <form method="get" style="display:grid;gap:12px;margin-top:10px">
      <div><label>From</label><input class="input" type="date" name="from" value="{{ request.args.get('from','') }}"></div>
      <div><label>To</label><input class="input" type="date" name="to" value="{{ request.args.get('to','') }}"></div>
      <div>
        <label>Customer</label>
        <select class="select" name="customer">
          <option value="">All</option>
          {% for c in customers %}
          <option value="{{ c[0] }}" {% if request.args.get('customer')==c[0]|string %}selected{% endif %}>{{ c[1] }}</option>
          {% endfor %}
        </select>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn">Apply</button>
        <a class="btn ghost" href="{{ url_for('reports.sales_export', **request.args) }}">Export CSV</a>
      </div>
    </form>
  </div>

  <div class="card fade-in" style="grid-column: span 2;">
    <div style="display:flex;gap:30px;flex-wrap:wrap">
      <div>
        <small>Records</small>
        <div style="font-size:34px;font-weight:800">{{ sales|length }}</div>
      </div>
      <div>
        <small>Revenue</small>
        <div style="font-size:34px;font-weight:800">₹{{ (total_revenue or 0)|int }}</div>
      </div>
      <div>
        <small>Items sold</small>
        <div style="font-size:34px;font-weight:800">{{ (total_qty or 0)|int }}</div>
      </div>
      <div>
        <small>Avg order</small>
        <div style="font-size:34px;font-weight:800">₹{{ (avg_order or 0)|int }}</div>
      </div>
    </div>

    <div class="table-wrap" style="overflow:auto;margin-top:18px">
      <table class="table">
        <thead><tr><th>#</th><th>Date</th><th>Item</th><th>Qty</th><th>Total</th><th>Customer</th></tr></thead>
        <tbody>
          {% for s in sales %}
          <tr>
            <td><a href="{{ url_for('sales.detail', sale_id=s[0]) }}" style="color:#0071e3;text-decoration:none">{{ s[0] }}</a></td>
            <td>{{ s[1] }}</td>
            <td>{{ s[2] }}</td>
            <td>{{ s[3] }}</td>
            <td>₹{{ '%.0f'|format(s[4]) }}</td>
            <td>{{ s[5] or 'Walk-in' }}</td>
          </tr>
          {% else %}
          <tr><td colspan="6"><small>No sales found for this range.</small></td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
