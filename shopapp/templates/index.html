{% extends "layout.html" %}{% block title %}Dashboard Â· ShopApp{% endblock %}
{% block content %}
<div class="confettiBar" aria-hidden="true"></div>
<section class="card" style="margin-top:18px">
  <h1><span class="gradientAnim">Store.</span> Your day at a glance.</h1>
  <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;margin-top:10px;">
    <p class="subtle">Fast clarity for revenue, sales, credits & stock â€” without the noise.</p>
    <span id="smartTip" class="tip">ðŸ’¡ Tip: Press Alt + / to open Assistant.</span>
  </div>
</section>

<section class="grid-4">
  <div class="card kpi"><div class="coin">ðŸ’°</div><div><div class="kpiTitle">Revenue</div><div class="kpiValue" data-count="{{ today_rev or 0 }}">â‚¹0</div></div></div>
  <div class="card kpi"><div class="coin">ðŸ›’</div><div><div class="kpiTitle">Sales</div><div class="kpiValue" data-count="{{ today_count or 0 }}">0</div></div></div>
  <div class="card kpi"><div class="coin">ðŸ“„</div><div><div class="kpiTitle">Unpaid credits</div><div class="kpiValue" data-count="{{ unpaid_credits or 0 }}">â‚¹0</div></div></div>
  <div class="card kpi"><div class="coin">ðŸ“¦</div><div><div class="kpiTitle">Low stock</div><div class="kpiValue" data-count="{{ low_stock_count or 0 }}">0</div></div></div>
</section>

<section class="grid-2-1">
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
      <h3>7-day performance</h3>
      <a href="/analytics" class="btn link breathe">Open Analytics</a>
    </div>
    <canvas id="chart7" height="150"></canvas>
  </div>
  <div class="card">
    <h3>Quick sale</h3>
    <form method="POST" action="/sell" style="display:grid;gap:10px;margin-top:6px;">
      <div><label class="kpiTitle">Item</label><select class="select" name="item_id" required>{% for i in items %}<option value="{{ i[0] }}">{{ i[1] }} (â‚¹{{ i[2] }}, {{ i[3] }} left)</option>{% endfor %}</select></div>
      <div><label class="kpiTitle">Customer</label><select class="select" name="customer_id"><option value="">Walk-in</option>{% for c in customers %}<option value="{{ c[0] }}">{{ c[1] }} ({{ c[2] }})</option>{% endfor %}</select></div>
      <div><label class="kpiTitle">Quantity</label><input class="input" type="number" name="quantity" min="1" required/></div>
      <button class="btn primary full" onclick="ShopFX.ping(920,160)">Sell</button>
    </form>
  </div>
</section>
{% endblock %}
{% block scripts %}
{{ super() }}
<script>
  document.querySelectorAll('.kpiValue[data-count]').forEach(el=>ShopFX.countUp(el,{money:el.textContent.trim().startsWith('â‚¹')}));
  ShopFX.rotateTip(document.getElementById('smartTip'),[
    "ðŸ’¡ Tip: Use Quick sale to log in 3 taps.",
    "ðŸ“ˆ Add expenses to see real profit.",
    "ðŸ”” Set WhatsApp reminders for unpaid credits.",
    "âŒ¨ï¸ Press Alt + / to open Assistant."
  ]);
  const d={{ chart_data or [] | tojson }}, ctx=document.getElementById('chart7');
  if(ctx&&d.length){new Chart(ctx,{type:'line',data:{labels:d.map(r=>r.t),datasets:[
    {label:'Revenue',data:d.map(r=>r.rev),borderColor:'#7d00ff',backgroundColor:'rgba(125,0,255,.12)',tension:.35,fill:true},
    {label:'Expenses',data:d.map(r=>r.exp),borderColor:'#ff007a',backgroundColor:'rgba(255,0,122,.10)',tension:.35,fill:true}]},
    options:{plugins:{legend:{labels:{color:'#1d1d1f'}}},scales:{x:{grid:{color:'#eee'}},y:{grid:{color:'#eee'}}}}});}
</script>
{% endblock %}
