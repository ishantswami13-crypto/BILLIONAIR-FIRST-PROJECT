{% extends "layout.html" %}
{% block title %}Dashboard &middot; Evara{% endblock %}

{% block content %}
<section class="ev-hero">
  <div class="ev-hero__copy">
    <h1>Make every sale feel effortless</h1>
    <p class="sub">Clear numbers. Calm design. Nightly WhatsApp & email reports on autopilot.</p>
    <div class="cta-row">
      <a href="{{ url_for('sales.index') }}" class="ev-btn">Start quick sale</a>
      <a href="{{ url_for('reports.zreport_view') }}" class="ev-btn ev-btn--ghost">All activity</a>
    </div>
  </div>
  <div class="ev-hero__ambient" aria-hidden="true">
    <span class="blob b1"></span>
    <span class="blob b2"></span>
    <span class="blob b3"></span>
  </div>
</section>

<section class="dashboard-stats">
  <div class="stat-box">
    <h3>Today's Revenue</h3>
    <p class="value">â‚¹{{ '%.2f'|format(todays_revenue or 0) }}</p>
    <span class="sub">Updated just now</span>
  </div>
  <div class="stat-box">
    <h3>Today's Orders</h3>
    <p class="value">{{ todays_orders or 0 }}</p>
    <span class="sub">Across all items</span>
  </div>
  <div class="stat-box">
    <h3>Low Stock</h3>
    <p class="value">{{ low_stock_count or 0 }}</p>
    <span class="sub">Items running low</span>
  </div>
</section>

<section class="ev-panels">
  <article class="ev-card chart">
    <div class="card-head">
      <h3>Last 7 days</h3>
      <span class="muted">Revenue &middot; Orders</span>
    </div>
    <canvas id="evChart" height="140"></canvas>
  </article>

  <article class="ev-card list">
    <div class="card-head">
      <h3>Recent sales</h3>
      <a class="ev-link small" href="{{ url_for('sales.history') }}">View all</a>
    </div>
    <ul class="ev-list">
      {% for s in sales[:8] if sales %}
        <li>
          <span class="item">{{ s[2] }}</span>
          <span class="meta">x{{ s[3] }}</span>
          <span class="amt">&#8377;{{ '%.2f'|format(s[4]) }}</span>
        </li>
      {% else %}
        <li class="muted">No sales yet. Create your first sale.</li>
      {% endfor %}
    </ul>
  </article>
</section>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
  const labels = {{ (last7_labels or [])|tojson }};
  const revenue = {{ (last7_revenue or [])|tojson }};
  const orders  = {{ (last7_orders  or [])|tojson }};

  const ctx = document.getElementById('evChart');
  if (ctx && labels.length) {
    new Chart(ctx, {
      type: 'line',
      data: {
        labels,
        datasets: [
          { label: 'Revenue', data: revenue, borderColor: '#21c997', fill: true, backgroundColor: 'rgba(33,201,151,.12)', tension:.35 },
          { label: 'Orders',  data: orders,  borderColor: '#007aff', fill: false, tension:.35 },
        ]
      },
      options: {
        plugins: { legend: { labels: { color: '#5c6270' } } },
        scales: {
          x: { ticks: { color: '#7a8091' }, grid: { color: 'rgba(0,0,0,.05)' } },
          y: { ticks: { color: '#7a8091' }, grid: { color: 'rgba(0,0,0,.05)' } }
        }
      }
    });
  }
</script>
{% endblock %}
