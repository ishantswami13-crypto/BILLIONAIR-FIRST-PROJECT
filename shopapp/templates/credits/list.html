{% extends "layout.html" %}
{% block title %}Credits Â· ShopApp{% endblock %}
{% block content %}

<div class="aurora" aria-hidden="true"></div>

<section class="card">
  <h1><span class="gradientAnim">Credits.</span> Smooth tracking.</h1>
  <p class="subtle" style="margin-top:8px;">Mark payments, send reminders, and relax.</p>
  <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;">
    <a class="btn secondary" href="{{ url_for('credits.new') }}">+ New Credit</a>
    <a class="btn link" href="{{ url_for('credits.send_reminders') }}">Send All Reminders</a>
  </div>
</section>

<section class="grid-4">
  <div class="card kpi"><div class="coin">ðŸ“„</div><div><div class="kpiTitle">Unpaid</div><div class="kpiValue" data-count="{{ unpaid_count or 0 }}">0</div></div></div>
  <div class="card kpi"><div class="coin">ðŸ’°</div><div><div class="kpiTitle">Unpaid total</div><div class="kpiValue" data-count="{{ total_unpaid or 0 }}">â‚¹0</div></div></div>
  <div class="card kpi"><div class="coin">ðŸ“¬</div><div><div class="kpiTitle">Reminders 30d</div><div class="kpiValue" data-count="{{ reminders_30d or 0 }}">0</div></div></div>
  <div class="card kpi"><div class="coin">âœ…</div><div><div class="kpiTitle">Paid this week</div><div class="kpiValue" data-count="{{ paid_week or 0 }}">â‚¹0</div></div></div>
</section>

<section class="card">
  <h3>Ledger</h3>
  <div class="table-wrap" style="overflow:auto;margin-top:12px;">
    <table class="table">
      <thead><tr><th>#</th><th>Date</th><th>Customer</th><th>Item</th><th>Qty</th><th>Total</th><th>Status</th><th>Actions</th></tr></thead>
      <tbody>
        {% for c in credits %}
        <tr>
          <td>{{ c.id }}</td><td>{{ c.date }}</td><td>{{ c.customer }}</td><td>{{ c.item }}</td><td>{{ c.quantity }}</td>
          <td>â‚¹{{ '%.0f'|format(c.total) }}</td>
          <td>{% if c.status=='paid' %}
            <span class="badge" style="color:#22c55e;border-color:#22c55e;">Paid</span>
            {% else %}
            <span class="badge" style="color:#ff6b9b;border-color:#ff6b9b;">Unpaid</span>
          {% endif %}</td>
          <td>
            {% if c.status!='paid' %}
              <a class="btn link" href="{{ url_for('credits.pay', credit_id=c.id) }}" onclick="ShopFX.ping(700,180)">Mark paid</a>
              <a class="btn secondary" href="{{ url_for('credits.send_one', credit_id=c.id) }}">Send</a>
            {% endif %}
          </td>
        </tr>
        {% else %}
        <tr><td colspan="8" class="subtle">No credits yet âœ¨</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>

{% endblock %}
{% block scripts %}
<script>
document.querySelectorAll('.kpiValue[data-count]').forEach(el=>{
  const money = el.textContent.trim().startsWith('â‚¹');
  ShopFX.countUp(el,{money});
});
</script>
{% endblock %}
