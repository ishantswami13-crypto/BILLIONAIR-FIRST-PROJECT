{% extends "layout.html" %}
{% block title %}Credits · ShopApp{% endblock %}

{% block content %}
<section class="hero fade-in" style="padding:70px 10% 30px">
  <h1>Credits</h1>
  <p>Track unpaid credits, send reminders, and mark payments.</p>
</section>

<div class="grid">
  <div class="card fade-in">
    <h2>Actions</h2>
    <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:6px">
      <a class="btn" href="{{ url_for('credits.new') }}">+ New Credit</a>
      <a class="btn ghost" href="{{ url_for('credits.send_reminders') }}">Send all reminders</a>
    </div>
  </div>

  <div class="card fade-in">
    <small>Unpaid count</small>
    <div style="font-size:34px;font-weight:800">{{ unpaid_count or 0 }}</div>
  </div>
  <div class="card fade-in">
    <small>Unpaid total</small>
    <div style="font-size:34px;font-weight:800">₹{{ (total_unpaid or 0)|int }}</div>
  </div>
  <div class="card fade-in">
    <small>Reminders (30d)</small>
    <div style="font-size:34px;font-weight:800">{{ reminders_30d or 0 }}</div>
  </div>

  <div class="card fade-in" style="grid-column: span 2;">
    <h2>Ledger</h2>
    <div class="table-wrap" style="overflow:auto;margin-top:10px">
      <table class="table">
        <thead><tr><th>#</th><th>Date</th><th>Customer</th><th>Item</th><th>Qty</th><th>Total</th><th>Status</th><th></th></tr></thead>
        <tbody>
        {% for c in credits %}
          <tr>
            <td>{{ c.id }}</td><td>{{ c.date }}</td><td>{{ c.customer }}</td><td>{{ c.item }}</td><td>{{ c.quantity }}</td>
            <td>₹{{ '%.0f'|format(c.total) }}</td>
            <td>{% if c.status=='paid' %}Paid{% else %}Unpaid{% endif %}</td>
            <td style="white-space:nowrap">
              {% if c.status!='paid' %}
                <a class="btn ghost" href="{{ url_for('credits.pay', credit_id=c.id) }}">Mark paid</a>
                <a class="btn" href="{{ url_for('credits.send_one', credit_id=c.id) }}">Send</a>
              {% endif %}
            </td>
          </tr>
        {% else %}
          <tr><td colspan="8"><small>No credits yet.</small></td></tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
