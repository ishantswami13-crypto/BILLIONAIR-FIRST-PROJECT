{% extends "layout.html" %}
{% block title %}Branding Settings{% endblock %}

{% block content %}
<section class="card">
  <div class="d-flex justify-content-between align-items-center flex-column" style="gap:16px;">
    <div class="d-flex flex-column gap-1">
      <h1 style="font-size:var(--f-xl);font-weight:700;">Branding & Theme</h1>
      <p class="text-muted">Curate how your Apple-class business OS looks across dashboards, invoices, and reports.</p>
    </div>
    <div class="d-flex gap-2">
      <a class="btn ghost" href="{{ url_for('settings.branding') }}">Branding</a>
      <a class="btn ghost" href="{{ url_for('settings.access_dashboard') }}">Access</a>
      <a class="btn ghost" href="{{ url_for('settings.connect_hub') }}">Connect</a>
    </div>
  </div>
</section>

<form method="POST" enctype="multipart/form-data" class="grid" style="grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:20px;margin-top:20px;">
  <section class="card">
    <h3 style="font-size:var(--f-lg);font-weight:600;" class="mb-2">Identity</h3>
    <div class="input-row two">
      <div>
        <label for="brandName">Business name</label>
        <input id="brandName" type="text" name="name" value="{{ profile.name or '' }}" required>
      </div>
      <div>
        <label for="invoicePrefix">Invoice prefix</label>
        <input id="invoicePrefix" type="text" name="invoice_prefix" value="{{ profile.invoice_prefix or 'INV' }}">
      </div>
    </div>
    <div class="input-row" style="margin-top:14px;">
      <div>
        <label for="brandAddress">Address</label>
        <textarea id="brandAddress" name="address" rows="3">{{ profile.address or '' }}</textarea>
      </div>
    </div>
    <div class="input-row three" style="margin-top:14px;">
      <div>
        <label for="brandPhone">Phone</label>
        <input id="brandPhone" type="text" name="phone" value="{{ profile.phone or '' }}">
      </div>
      <div>
        <label for="brandGST">GST Number</label>
        <input id="brandGST" type="text" name="gst" value="{{ profile.gst or '' }}">
      </div>
      <div>
        <label for="themeSelect">UI Theme</label>
        <select id="themeSelect" name="ui_theme">
          <option value="mint" {% if current_theme == 'mint' %}selected{% endif %}>Mint</option>
          <option value="purple" {% if current_theme == 'purple' %}selected{% endif %}>Purple</option>
        </select>
      </div>
    </div>
    <div class="input-row two" style="margin-top:14px;">
      <div>
        <label for="primaryColor">Primary colour</label>
        <input id="primaryColor" type="color" name="primary_color" value="{{ profile.primary_color or '#0A2540' }}">
      </div>
      <div>
        <label for="secondaryColor">Secondary colour</label>
        <input id="secondaryColor" type="color" name="secondary_color" value="{{ profile.secondary_color or '#62b5ff' }}">
      </div>
    </div>
  </section>

  <section class="card">
    <h3 style="font-size:var(--f-lg);font-weight:600;" class="mb-2">Assets</h3>
    <div class="input-row">
      <div>
        <label for="logoUpload">Logo (PNG/SVG)</label>
        <input id="logoUpload" type="file" name="logo" accept=".png,.jpg,.jpeg,.svg">
        {% if profile.logo_path %}
          <div class="text-muted small mt-2">Current: {{ profile.logo_path }}</div>
        {% endif %}
      </div>
      <div>
        <label for="signatureUpload">Authorised signature</label>
        <input id="signatureUpload" type="file" name="signature" accept=".png,.jpg,.jpeg">
        {% if profile.signature_path %}
          <div class="text-muted small mt-2">Current: {{ profile.signature_path }}</div>
        {% endif %}
      </div>
      <div>
        <label for="watermarkUpload">Watermark</label>
        <input id="watermarkUpload" type="file" name="watermark" accept=".png,.jpg,.jpeg">
        {% if profile.watermark_path %}
          <div class="text-muted small mt-2">Current: {{ profile.watermark_path }}</div>
        {% endif %}
      </div>
    </div>
    <div class="d-flex justify-content-end" style="margin-top:20px;">
      <button class="btn primary" type="submit">Save Branding</button>
    </div>
  </section>
</form>

<section class="card" style="margin-top:20px;">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <div>
      <h3 class="mb-1" style="font-size:var(--f-lg);font-weight:600;">End-of-day lock</h3>
      <div class="text-muted small">After nightly reports, sales and expenses freeze for auditing. Unlocking is logged.</div>
    </div>
    {% if sales_lock %}
      <span class="badge-soft text-warning">Locked for {{ sales_lock.value }}</span>
    {% else %}
      <span class="badge-soft text-success">Unlocked</span>
    {% endif %}
  </div>
  <form method="POST" action="{{ url_for('settings.unlock_day') }}" class="input-row">
    <div>
      <label for="unlockReason">Override reason</label>
      <textarea id="unlockReason" name="reason" rows="2" placeholder="Explain why books need to reopen. Logged for audit." required></textarea>
    </div>
    <div class="d-flex justify-content-end">
      <button class="btn ghost" type="submit">Override &amp; unlock</button>
    </div>
  </form>
  {% if lock_reason %}
    <p class="text-muted small mt-2 mb-0">Last action: {{ lock_reason.value }}</p>
  {% endif %}
</section>
{% endblock %}
